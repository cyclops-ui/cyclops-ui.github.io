"use strict";(self.webpackChunkcyclops_ui_docs=self.webpackChunkcyclops_ui_docs||[]).push([[333],{17025:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>i});var a=s(85893),n=s(11151);const r={},o="Private templates",l={id:"templates/private_templates",title:"Private templates",description:"You might want to store your templates in a private repository and load them into Cyclops, but you must authorize Cyclops to be able to pull the template.",source:"@site/docs/templates/private_templates.md",sourceDirName:"templates",slug:"/templates/private_templates",permalink:"/docs/templates/private_templates",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Helm chart dependencies",permalink:"/docs/templates/dependencies"},next:{title:"Roadmap",permalink:"/docs/roadmap/"}},c={},i=[{value:"About",id:"about",level:2},{value:"Example",id:"example",level:2}];function p(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",img:"img",p:"p",pre:"pre",strong:"strong",...(0,n.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"private-templates",children:"Private templates"}),"\n",(0,a.jsx)(t.p,{children:"You might want to store your templates in a private repository and load them into Cyclops, but you must authorize Cyclops to be able to pull the template."}),"\n",(0,a.jsx)(t.h2,{id:"about",children:"About"}),"\n",(0,a.jsxs)(t.p,{children:["Cyclops has a ",(0,a.jsx)(t.code,{children:"CRD (Custom Resource Definition)"})," that allows you to define authorization for specific repositories. You can set different authorization data for different templates. The CRD defines which templates you want to authorize and points Cyclops to the authorization data needed for those templates."]}),"\n",(0,a.jsxs)(t.p,{children:["Each time the Cyclops controller fetches a template, it retrieves ",(0,a.jsx)(t.strong,{children:"TemplateAuthRule (TAR)"})," custom resources from the cluster and checks if the template host matches any of the TemplateAuthRules. If it does, it will fetch the Kubernetes secrets TemplateAuthRule references and apply username and password to authenticate."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Dependencies rendering",src:s(67591).Z+"",width:"1056",height:"763"})}),"\n",(0,a.jsxs)(t.p,{children:["In the image above, Cyclops controller fetches all TARs and matches the template host to ",(0,a.jsx)(t.code,{children:"spec.repo"}),". If it matches, it will fetch the username and password from the referenced secret. In this case, both username and password reference the same secret ",(0,a.jsx)(t.code,{children:"my-cyclops-secret"})," (",(0,a.jsx)(t.code,{children:"spec.username.name"})," and ",(0,a.jsx)(t.code,{children:"spec.password.name"}),")."]}),"\n",(0,a.jsxs)(t.p,{children:["To fetch the username secret value, the Cyclops controller will fetch the referenced secret and use the key provided in ",(0,a.jsx)(t.code,{children:"spec.username.key"})," to get the value from the fetched secret. The same goes for the password."]}),"\n",(0,a.jsxs)(t.p,{children:["TemplateAuthRules (TARs) do not store secrets directly, so you can still integrate your cluster with the ",(0,a.jsx)(t.a,{href:"https://external-secrets.io/",children:"External Secret Operator"})," or other secrets management solutions."]}),"\n",(0,a.jsx)(t.p,{children:"You can add new TARs and secrets without restarting your Cyclops controller; the Cyclops controller fetches TARs in runtime."}),"\n",(0,a.jsx)(t.h2,{id:"example",children:"Example"}),"\n",(0,a.jsxs)(t.p,{children:["Through an example, we will authenticate a Cyclops instance to fetch a private template. Before we start, you can try to create a template reference to the private template. Create a template reference by going to ",(0,a.jsx)(t.strong,{children:"Templates"})," in the sidebar and clicking ",(0,a.jsx)(t.strong,{children:"Add template reference"}),"."]}),"\n",(0,a.jsx)("p",{align:"center",width:"100%",children:(0,a.jsx)("img",{src:"/img/templates/private-templates/add-template.png",width:"90%"})}),"\n",(0,a.jsx)(t.p,{children:"You will need to set the name for the private template as well as the repository, path, and version of your template. You will see an error like the one below."}),"\n",(0,a.jsx)("p",{align:"center",width:"100%",children:(0,a.jsx)("img",{src:"/img/templates/private-templates/error-adding.png",width:"70%"})}),"\n",(0,a.jsxs)(t.p,{children:["To authenticate Cyclops to fetch your private template, you must create a GitHub token. You can follow these ",(0,a.jsx)(t.a,{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-personal-access-token-classic",children:"steps"}),". Make sure to add ",(0,a.jsx)(t.code,{children:"repo"})," access to the token."]}),"\n",(0,a.jsx)(t.p,{children:"Once you have generated your GitHub token, create a secret in your Kubernetes cluster with your username and GH token."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"kubectl create secret generic my-cyclops-secret \\\n    -n cyclops \\\n    --from-literal=username=<github-username> \\\n    --from-literal=password=<github-token>\n"})}),"\n",(0,a.jsx)(t.p,{children:"You will also need a TemplateAuthRule that will reference the newly created secret. You can create a file with its configuration and apply it to the cluster."}),"\n",(0,a.jsx)(t.p,{children:"Create the file:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"# template_auth_rule.yaml\n\napiVersion: cyclops-ui.com/v1alpha1\nkind: TemplateAuthRule\nmetadata:\n  name: private-repo-rule\n  namespace: cyclops            # has to be in cyclops namespace\nspec:\n  repo: <github-repo>           # your private repo\n  password:\n    name: my-cyclops-secret     # name of the previously created secret\n    key: password\n  username:\n    name: my-cyclops-secret     # name of the previously created secret\n    key: username\n"})}),"\n",(0,a.jsx)(t.p,{children:"Apply to the cluster:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"kubectl apply -f template_auth_rule.yaml\n"})}),"\n",(0,a.jsx)(t.p,{children:"You should see the output below"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"templateauthrule.cyclops-ui.com/private-repo-rule created\n"})}),"\n",(0,a.jsxs)(t.p,{children:["You can now add the same template reference that failed before, and it should now be added so you can use it when creating Modules. You can create a module by going to: ",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(t.strong,{children:"Modules"})," (in the sidebar) ",(0,a.jsx)(t.strong,{children:">"})," ",(0,a.jsx)(t.strong,{children:"Add module"})," ",(0,a.jsx)(t.strong,{children:">"})," select your private template in ",(0,a.jsx)(t.strong,{children:"Module template"})]})]})}function d(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},67591:(e,t,s)=>{s.d(t,{Z:()=>a});const a=s.p+"assets/images/tar_arch-5b6899ed6cccdacf11d3f4348f97a284.png"},11151:(e,t,s)=>{s.d(t,{Z:()=>l,a:()=>o});var a=s(67294);const n={},r=a.createContext(n);function o(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);